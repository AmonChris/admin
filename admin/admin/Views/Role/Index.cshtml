
@{
    ViewData["Title"] = "Index";
    Layout = "_IndexLayout";
}

<table class="layui-hide" id="table" lay-filter="table"></table>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="create">新增</button>
        <button class="layui-btn layui-btn-sm" lay-event="batchDelete">批量删除</button>
    </div>
</script>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

@section Scripts{
    <script>
        layui.use(['table', 'layer'], function (table, layer) {
            var $ = layui.jquery;
            table.render({
                elem: '#table'
                , url: '/api/role'
                , toolbar: '#toolbarDemo'
                , title: '角色表'
                , cols: [[
                    { type: 'checkbox', fixed: 'left' }
                    , { field: 'id', title: 'id', hide: true, width: 120 }
                    , { field: 'name', title: '角色名', width: 120 }
                    , { field: 'memo', title: '描述', width: 120 }
                    , { field: 'createTime', title: '加入时间', width: 120 }
                    , { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 150 }
                ]]
                , page: true
                , parseData: function (res) { //res 即为原始返回的数据
                    return {
                        "code": res.status, //解析接口状态
                        "msg": res.msg, //解析提示文本
                        "count": res.data.length, //解析数据长度
                        "data": res.data //解析数据列表
                    };
                }
                , response: {
                    statusCode: 1 //规定成功的状态码，默认：0
                }
            });

            //头工具栏事件
            table.on('toolbar(table)', function (obj) {
                var checkStatus = table.checkStatus(obj.config.id);
                switch (obj.event) {
                    case 'create':
                        layer.open({
                            type: 2,
                            area: ['450px', '400px'],
                            content: '/role/create' //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                        });
                        break;
                    case 'batchDelete':
                        var data = checkStatus.data;
                        layer.msg('选中了：' + data.length + ' 个');
                        break;
                };
            });

            //监听行工具事件
            table.on('tool(table)', function (obj) {
                var data = obj.data;
                //console.log(obj)
                if (obj.event === 'del') {
                    layer.confirm('真的删除行么', function (index) {
                        $.ajax({
                            url: "/api/role/" + data.id,
                            type: "delete",
                            success: function (res) {
                                frameMsg(res.msg);
                                if (res.status == 1) {
                                    obj.del();
                                }
                            }
                        });

                        layer.close(index);
                    });
                } else if (obj.event === 'edit') {
                    layer.open({
                        type: 2,
                        area: ['450px', '400px'],
                        content: '/role/edit?id=' + data.id //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                    });
                }
            });
        });
    </script>
}

