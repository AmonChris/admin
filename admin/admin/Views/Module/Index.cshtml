
@{
    ViewData["Title"] = "Index";
    Layout = "_IndexLayout";
}

<div style="width:50%; float:left;">
    <table class="layui-hide" id="table" lay-filter="table"></table>
</div>
<div style="width:50%; height:100%; float:left;">
    <iframe id="moduleOperate" name="moduleOperate" style="width: 100%; min-height: 100%; height:400px;" scrolling="no" frameborder="no"></iframe>
</div>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="create">新增</button>
        <button class="layui-btn layui-btn-sm" lay-event="batchDelete">批量删除</button>
    </div>
</script>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

@section Scripts{
    <script>
        layui.use(['table', 'layer'], function (table, layer) {
            var $ = layui.jquery;
            table.render({
                elem: '#table'
                , url: '/api/module'
                , toolbar: '#toolbarDemo'
                , initSort: {
                    field: 'sort' //排序字段，对应 cols 设定的各字段名
                    , type: 'asc' //排序方式  asc: 升序、desc: 降序、null: 默认排序
                }
                , title: '角色表'
                , cols: [[
                    { type: 'checkbox', fixed: 'left' }
                    , { field: 'id', title: 'id', hide: true, width: 120 }
                    , { field: 'sort', title: 'sort', hide: true, width: 120 }
                    , { field: 'name', title: '模块名称', width: 120 }
                    , { field: 'link', title: '链接', width: 120 }
                    , {
                        field: 'icon', title: '图标', width: 60, templet: function (d) {
                            return '<i class="layui-icon ' + d.icon + '"></i>';
                        }
                    }
                    , {
                        field: 'isBase', title: '是否基础模块', width: 120, templet: function (d) {
                            if (d.isBase == 0) {
                                return '<i class="layui-icon layui-icon-close" style="font-weight: bolder; color: #FF5722;"></i>';
                            } else {
                                return '<i class="layui-icon layui-icon-ok" style="color: #5FB878;"></i>';
                            }
                        }
                    }
                    , { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 150 }
                ]]
                , page: true
                , parseData: function (res) { //res 即为原始返回的数据
                    return {
                        "code": res.status, //解析接口状态
                        "msg": res.msg, //解析提示文本
                        "count": res.data.length, //解析数据长度
                        "data": res.data //解析数据列表
                    };
                }
                , response: {
                    statusCode: 1 //规定成功的状态码，默认：0
                }
            });

            //头工具栏事件
            table.on('toolbar(table)', function (obj) {
                var checkStatus = table.checkStatus(obj.config.id);
                switch (obj.event) {
                    case 'create':
                        layer.open({
                            type: 2,
                            area: ['450px', '500px'],
                            content: '/module/create' //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                        });
                        break;
                    case 'batchDelete':
                        var data = checkStatus.data;
                        layer.msg('选中了：' + data.length + ' 个');
                        break;
                };
            });
            // 监听行单击事件
            table.on('row(table)', function (obj) {
                $("#moduleOperate").attr('src', '/module/OperateIndex?moduleId=' + obj.data.id);
            });

            //监听行工具事件
            table.on('tool(table)', function (obj) {
                var data = obj.data;
                //console.log(obj)
                if (obj.event === 'del') {
                    layer.confirm('真的删除行么', function (index) {
                        $.ajax({
                            url: "/api/module/" + data.id,
                            type: "delete",
                            success: function (res) {
                                frameMsg(res.msg);
                                if (res.status == 1) {
                                    obj.del();
                                }
                            }
                        });

                        layer.close(index);
                    });
                } else if (obj.event === 'edit') {
                    layer.open({
                        type: 2,
                        area: ['450px', '500px'],
                        content: '/module/edit?id=' + data.id //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                    });
                }
            });
        });
    </script>
}

